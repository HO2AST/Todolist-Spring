<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.exam.mapper.TodoMapper">
	<select id="selectTodo" parameterType="String" resultType="map">
		SELECT USERID, TODO, REGDATE
		FROM todolist 
		WHERE USERID = #{userId}
		AND REGDATE = DATE_FORMAT(NOW(), '%Y%m%d')
	</select>
	
	<insert id="writeTodo" parameterType="TodoVO">
		INSERT INTO todolist
		VALUES(#{userId}, #{todo}, DATE_FORMAT(NOW(), '%Y%m%d'))
	</insert>
	
	<select id="addTodo" parameterType="String" resultType="map">
		SELECT A.USERID, A.TODO
		  FROM (
		  		SELECT ROW_NUMBER() OVER (PARTITION BY USERID ORDER BY REGTIME) AS ROWNUM
				   	 , USERID
					 , TODO
					 , REGDATE
				  FROM todolist
				 WHERE USERID = #{userId} AND REGDATE = DATE_FORMAT(NOW(), '%Y%m%d')
			   ) A
		 WHERE A.ROWNUM = '1'
	</select>
</mapper>